{{- define "title" }}{{ .Title }} - {{ .Site.Title }}{{ end -}}

{{- define "content" -}}
    {{- $params := .Scratch.Get "params" -}}
    <article class="page single">

        {{- /* Title */ -}}
        <h2 class="single-title-user animated fadeInDown faster" >
            {{- .Title -}}
        </h2>

        <div class="single-card-user"  >
        {{- partial "user/profile.html" . -}}
        {{- partial "user/invite.html" . -}}
        </div>

        <div class="single-card-user">
            {{- /* Content */ -}}
            <div class="content" id="content">
                {{- $content := .Content -}}
                {{- $content = dict "Content" .Content "Ruby" $params.ruby "Fraction" $params.fraction "Fontawesome" $params.fontawesome | partial "function/content.html" -}}
                {{- $content | replaceRE "<p><figure>" "<figure>" | replaceRE "(?s:</figure>\n?</p>)" "</figure>" | replaceRE "https://www.w3.org/" "http://www.w3.org/"| replaceRE "font-weight:550" "font-weight:500" | replaceRE "<section" "<div" | replaceRE "</section" "</div" | replaceRE `<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">` `<div class="video">` | replaceRE ` style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;"` `` | replaceRE " webkitallowfullscreen mozallowfullscreen" "" | replaceRE "allowfullscreen" `allow="fullscreen"` | replaceRE `type="application/javascript"` `` | replaceRE `charset="utf-8"></script>` `></script>` | replaceRE `<div id="fb-root"></div>` `` | safeHTML -}}
            </div>
        </div>
    </article>
<script>
    // ajax
    var site = 'http://g.jump.cc';
    var xhr = new XMLHttpRequest();
    xhr.withCredentials = true;

    xhr.open('POST',site+'/user/info');
    xhr.send();
    xhr.onreadystatechange = function (){
        if (xhr.readyState == 4 && xhr.status == 200 ){
            var r = xhr.responseText;
            alert(r)
            r = r.split(',');
            if (r[0] == 'ok'){
                document.querySelector("#invitelink").innerHTML=r[1];
                document.querySelector("#name").innerHTML=r[2];
                document.querySelector("#email").innerHTML=r[3];
                document.querySelector("#coins").innerHTML=r[4];
                document.querySelector("#urlclicks").innerHTML=r[5];
                document.querySelector("#devices").innerHTML=r[6];
                document.querySelector("#invites").innerHTML=r[7];
            }else{
                window.alert(xhr.responseText);
                window.location.href = '/in';
            }
        }
    }
</script>
{{- end -}}
