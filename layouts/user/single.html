{{- define "title" }}{{ .Title }} - {{ .Site.Title }}{{ end -}}

{{- define "content" -}}
    {{- $params := .Scratch.Get "params" -}}
    <article class="page single">

        {{- /* Title */ -}}
        <h2 class="single-title-user animated fadeInDown faster" >
            {{- .Title -}}
        </h2>

        <div class="single-card-user"  >
        {{- partial "user/profile.html" . -}}
        {{- partial "user/invite.html" . -}}
        </div>

        <div class="single-card-user">
            {{- /* Content */ -}}
            <div class="content" id="content">
                {{- $content := .Content -}}
                {{- $content = dict "Content" .Content "Ruby" $params.ruby "Fraction" $params.fraction "Fontawesome" $params.fontawesome | partial "function/content.html" -}}
                {{- $content | replaceRE "<p><figure>" "<figure>" | replaceRE "(?s:</figure>\n?</p>)" "</figure>" | replaceRE "https://www.w3.org/" "http://www.w3.org/"| replaceRE "font-weight:550" "font-weight:500" | replaceRE "<section" "<div" | replaceRE "</section" "</div" | replaceRE `<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">` `<div class="video">` | replaceRE ` style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;"` `` | replaceRE " webkitallowfullscreen mozallowfullscreen" "" | replaceRE "allowfullscreen" `allow="fullscreen"` | replaceRE `type="application/javascript"` `` | replaceRE `charset="utf-8"></script>` `></script>` | replaceRE `<div id="fb-root"></div>` `` | safeHTML -}}
            </div>
        </div>
    </article>
<script>
    // auto https
    if (document.location.protocol == 'http:') {
        window.location.href = window.location.href.replace('http://','https://')
    }
    // ajax
    var site = 'https://gameapi.okxz.top';
    var xhr = new XMLHttpRequest();
    xhr.withCredentials = true;
    
    xhr.open('POST',site+'/user/info');
    xhr.send();
    xhr.onreadystatechange = function (){
        if (xhr.readyState == 4 && xhr.status == 200 ){
            var r = new URLSearchParams(xhr.responseText)
            if (r.get('status') == 'ok'){
                var inviteurl = 'https://' + document.domain + '/in/?' + r.get('id');
                var balance = r.get('coins') - r.get('urlclicks')
                document.querySelector("#invitecode").innerHTML=r.get('id');
                document.querySelector("#invitelink").value=inviteurl;
                document.querySelector("#name").innerHTML=r.get('name');
                document.querySelector("#email").innerHTML=r.get('email');
                document.querySelector("#coins").innerHTML=balance;
                document.querySelector("#urlclicks").innerHTML=r.get('urlclicks');
                document.querySelector("#invites").innerHTML=r.get('invites');
            }else if (r.get('status') == 'err'){
                window.alert(r.get('err'));
                window.location.href = '/in';
            }else {
                window.alert(xhr.responseText);
                window.location.href = '/in';
            }
        }
    }
</script>
{{- end -}}
